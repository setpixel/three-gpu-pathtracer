{"mappings":"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","sources":["example/interior.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet renderer, controls, sceneInfo, ptRenderer, camera, fsQuad;\nlet samplesEl;\nconst params = {\n\n\tenvironmentIntensity: 0,\n\tenvironmentRotation: 0,\n\temissiveIntensity: 100,\n\tbounces: 20,\n\tsamplesPerFrame: 1,\n\tresolutionScale: 1 / window.devicePixelRatio,\n\tfilterGlossyFactor: 0.25,\n\ttiles: 2,\n\n\n};\n\nif ( window.location.hash.includes( 'transmission' ) ) {\n\n\tparams.material1.metalness = 0.0;\n\tparams.material1.roughness = 0.05;\n\tparams.material1.transmission = 1.0;\n\tparams.material1.color = '#ffffff';\n\tparams.bounces = 10;\n\n}\n\n// clamp value for mobile\nconst aspectRatio = window.innerWidth / window.innerHeight;\nif ( aspectRatio < 0.65 ) {\n\n\tparams.bounces = Math.min( params.bounces, 10 );\n\tparams.resolutionScale *= 0.5;\n\tparams.tiles = 3;\n\n}\n\ninit();\n\nasync function init() {\n\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\n\tcamera.position.set( 0.4, 0.6, 2.65 );\n\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.camera = camera;\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\n\tfsQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t} ) );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.target.set( - 0.15, 0.33, - 0.08 );\n\tcamera.lookAt( controls.target );\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tcontrols.update();\n\n\tsamplesEl = document.getElementById( 'samples' );\n\n\tconst envMapPromise = new Promise( resolve => {\n\n\t\tnew RGBELoader()\n\t\t\t.load( 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr', texture => {\n\n\t\t\t\tptRenderer.material.envMapInfo.updateFrom( texture );\n\t\t\t\tresolve();\n\n\t\t\t} );\n\n\t} );\n\n\tconst generator = new PathTracingSceneWorker();\n\tconst gltfPromise = new GLTFLoader()\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/pathtracing-bathroom/modernbathroom.glb' )\n\t\t.then( gltf => {\n\n\t\t\tconst group = new THREE.Group();\n\t\t\tgroup.add( gltf.scene );\n\n\t\t\tconst box = new THREE.Box3();\n\t\t\tbox.setFromObject( gltf.scene );\n\n\t\t\tgroup.updateMatrixWorld();\n\n\t\t\tconst center = new THREE.Vector3();\n\t\t\tbox.getCenter( center );\n\n\t\t\tgltf.scene.position.addScaledVector( center, - 0.5 );\n\t\t\tgroup.updateMatrixWorld();\n\n\t\t\treturn generator.generate( group );\n\n\t\t} )\n\t\t.then( result => {\n\n\t\t\tsceneInfo = result;\n\n\t\t\tconst { bvh, textures, materials } = result;\n\t\t\tconst geometry = bvh.geometry;\n\t\t\tconst material = ptRenderer.material;\n\n\t\t\tmaterial.bvh.updateFrom( bvh );\n\t\t\tmaterial.normalAttribute.updateFrom( geometry.attributes.normal );\n\t\t\tmaterial.tangentAttribute.updateFrom( geometry.attributes.tangent );\n\t\t\tmaterial.uvAttribute.updateFrom( geometry.attributes.uv );\n\t\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\t\tmaterial.materials.updateFrom( materials, textures );\n\n\t\t\tgenerator.dispose();\n\n\t\t} );\n\n\tawait Promise.all( [ gltfPromise, envMapPromise ] );\n\n\twindow.CAMERA = camera;\n\twindow.CONTROLS = controls;\n\n\tdocument.getElementById( 'loading' ).remove();\n\n\tonResize();\n\twindow.addEventListener( 'resize', onResize );\n\n\tconst gui = new GUI();\n\tgui.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\n\n\t\tptRenderer.tiles.set( value, value );\n\n\t} );\n\tgui.add( params, 'samplesPerFrame', 1, 10, 1 );\n\tgui.add( params, 'filterGlossyFactor', 0, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'environmentIntensity', 0, 25 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'environmentRotation', 0, 40 ).onChange( v => {\n\n\t\tptRenderer.material.environmentRotation.setFromMatrix4( new THREE.Matrix4().makeRotationY( v ) );\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'emissiveIntensity', 0, 300 ).onChange( updateIntensity );\n\tgui.add( params, 'bounces', 1, 30, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'resolutionScale', 0.1, 1 ).onChange( () => {\n\n\t\tonResize();\n\n\t} );\n\n\tupdateIntensity();\n\n\tanimate();\n\n}\n\nfunction onResize() {\n\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = params.resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tptRenderer.setSize( w * scale * dpr, h * scale * dpr );\n\tptRenderer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\tcamera.aspect = w / h;\n\tcamera.updateProjectionMatrix();\n\n}\n\nfunction updateIntensity() {\n\n\tsceneInfo.materials.forEach( material => {\n\n\t\tmaterial.emissiveIntensity = params.emissiveIntensity;\n\n\t} );\n\tptRenderer.reset();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\n\tptRenderer.material.filterGlossyFactor = params.filterGlossyFactor;\n\tptRenderer.material.environmentIntensity = params.environmentIntensity;\n\tptRenderer.material.environmentBlur = 0.35;\n\tptRenderer.material.bounces = params.bounces;\n\n\tcamera.updateMatrixWorld();\n\n\tfor ( let i = 0, l = params.samplesPerFrame; i < l; i ++ ) {\n\n\t\tptRenderer.update();\n\n\t}\n\n\trenderer.autoClear = false;\n\tfsQuad.render( renderer );\n\trenderer.autoClear = true;\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n}\n\n\n\n\n"],"names":["$ilwiq","parcelRequire","$0d847323f1f8b53b$var$renderer","$0d847323f1f8b53b$var$controls","$0d847323f1f8b53b$var$sceneInfo","$0d847323f1f8b53b$var$ptRenderer","$0d847323f1f8b53b$var$camera","$0d847323f1f8b53b$var$fsQuad","$0d847323f1f8b53b$var$samplesEl","$0d847323f1f8b53b$var$params","environmentIntensity","environmentRotation","emissiveIntensity","bounces","samplesPerFrame","resolutionScale","window","devicePixelRatio","filterGlossyFactor","tiles","location","hash","includes","material1","metalness","roughness","transmission","color","$0d847323f1f8b53b$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","setSize","reset","setPixelRatio","aspect","updateProjectionMatrix","$0d847323f1f8b53b$var$updateIntensity","materials","forEach","material","$0d847323f1f8b53b$var$animate","requestAnimationFrame","updateFrom","textures","environmentBlur","updateMatrixWorld","i","l","update","autoClear","render","innerText","Math","floor","samples","min","async","WebGLRenderer","antialias","toneMapping","ACESFilmicToneMapping","document","body","appendChild","domElement","PerspectiveCamera","position","set","$4CEV9","PathTracingRenderer","camera","PhysicalPathTracingMaterial","$RPVlj","FullScreenQuad","MeshBasicMaterial","map","target","texture","$5Rd1x","OrbitControls","lookAt","addEventListener","getElementById","envMapPromise","Promise","resolve","$891vQ","RGBELoader","load","envMapInfo","generator","$cVdfP","PathTracingSceneWorker","gltfPromise","$7lx9d","GLTFLoader","setMeshoptDecoder","$kp7Te","MeshoptDecoder","loadAsync","then","gltf","group","Group","add","scene","box","Box3","setFromObject","center","Vector3","getCenter","addScaledVector","generate","result","bvh","geometry","normalAttribute","attributes","normal","tangentAttribute","tangent","uvAttribute","uv","materialIndexAttribute","materialIndex","setTextures","dispose","all","CAMERA","CONTROLS","remove","gui","$jiuw3","GUI","onChange","value","v","setFromMatrix4","Matrix4","makeRotationY","$0d847323f1f8b53b$var$init"],"version":3,"file":"interior.fb823b71.js.map"}